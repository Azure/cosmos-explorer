{"version":3,"file":"DiagnosticNodeInternal.js","sourceRoot":"","sources":["../../../src/diagnostics/DiagnosticNodeInternal.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { CosmosDiagnosticContext } from \"./CosmosDiagnosticsContext\";\nimport { RequestContext } from \"../request\";\nimport { v4 } from \"uuid\";\nimport {\n  DiagnosticNode,\n  MetadataLookUpType,\n  CosmosDiagnostics,\n  getRootNode,\n  ClientConfigDiagnostic,\n} from \"../CosmosDiagnostics\";\nimport { getCurrentTimestampInMs } from \"../utils/time\";\nimport { CosmosDbDiagnosticLevel } from \"./CosmosDbDiagnosticLevel\";\nimport { CosmosHeaders } from \"../queryExecutionContext/CosmosHeaders\";\nimport { HttpHeaders, PipelineResponse } from \"@azure/core-rest-pipeline\";\nimport { Constants, OperationType, ResourceType, prepareURL } from \"../common\";\nimport { allowTracing } from \"./diagnosticLevelComparator\";\n\n/**\n * @hidden\n * This is Internal Representation for DiagnosticNode. It contains useful helper functions to collect\n * diagnostic information throughout the lifetime of Diagnostic session.\n * The functions toDiagnosticNode() & toDiagnostic() are given to convert it to public facing counterpart.\n */\nexport class DiagnosticNodeInternal implements DiagnosticNode {\n  public id: string;\n  public nodeType: DiagnosticNodeType;\n  public parent: DiagnosticNodeInternal;\n  public children: DiagnosticNodeInternal[];\n  public data: Partial<DiagnosticDataValue>;\n  public startTimeUTCInMs: number;\n  public durationInMs: number;\n  public diagnosticLevel: CosmosDbDiagnosticLevel;\n  private diagnosticCtx: CosmosDiagnosticContext;\n\n  /**\n   * @internal\n   */\n  constructor(\n    diagnosticLevel: CosmosDbDiagnosticLevel,\n    type: DiagnosticNodeType,\n    parent: DiagnosticNodeInternal,\n    data: Partial<DiagnosticDataValue> = {},\n    startTimeUTCInMs: number = getCurrentTimestampInMs(),\n    ctx: CosmosDiagnosticContext = new CosmosDiagnosticContext(),\n  ) {\n    this.id = v4();\n    this.nodeType = type;\n    this.startTimeUTCInMs = startTimeUTCInMs;\n    this.data = data;\n    this.children = [];\n    this.durationInMs = 0;\n    this.parent = parent;\n    this.diagnosticCtx = ctx;\n    this.diagnosticLevel = diagnosticLevel;\n  }\n\n  /**\n   * @internal\n   */\n  private addLog(msg: string): void {\n    if (!this.data.log) {\n      this.data.log = [];\n    }\n    this.data.log.push(msg);\n  }\n\n  /**\n   * @internal\n   */\n  private sanitizeHeaders(headers?: CosmosHeaders | HttpHeaders): CosmosHeaders | HttpHeaders {\n    return headers;\n  }\n\n  /**\n   * Updated durationInMs for node, based on endTimeUTCInMs provided.\n   * @internal\n   */\n  public updateTimestamp(endTimeUTCInMs: number = getCurrentTimestampInMs()): void {\n    this.durationInMs = endTimeUTCInMs - this.startTimeUTCInMs;\n  }\n\n  /**\n   * @internal\n   */\n  public recordSuccessfulNetworkCall(\n    startTimeUTCInMs: number,\n    requestContext: RequestContext,\n    pipelineResponse: PipelineResponse,\n    substatus: number,\n    url: string,\n  ): void {\n    const responseHeaders = pipelineResponse.headers.toJSON();\n    const gatewayRequest = {\n      activityId: responseHeaders[Constants.HttpHeaders.ActivityId],\n      startTimeUTCInMs,\n      durationInMs: getCurrentTimestampInMs() - startTimeUTCInMs,\n      statusCode: pipelineResponse.status,\n      subStatusCode: substatus,\n      requestPayloadLengthInBytes: calculateRequestPayloadLength(requestContext),\n      responsePayloadLengthInBytes: calculateResponsePayloadLength(pipelineResponse),\n      operationType: requestContext.operationType,\n      resourceType: requestContext.resourceType,\n      partitionKeyRangeId: requestContext.partitionKeyRangeId,\n    };\n    let requestData: any = {\n      OperationType: gatewayRequest.operationType,\n      resourceType: gatewayRequest.resourceType,\n      requestPayloadLengthInBytes: gatewayRequest.requestPayloadLengthInBytes,\n    };\n\n    if (allowTracing(CosmosDbDiagnosticLevel.debugUnsafe, this.diagnosticLevel)) {\n      requestData = {\n        ...requestData,\n        headers: this.sanitizeHeaders(requestContext.headers),\n        requestBody: requestContext.body,\n        responseBody: pipelineResponse.bodyAsText,\n        url: url,\n      };\n    }\n    this.addData({\n      requestPayloadLengthInBytes: gatewayRequest.requestPayloadLengthInBytes,\n      responsePayloadLengthInBytes: gatewayRequest.responsePayloadLengthInBytes,\n      startTimeUTCInMs: gatewayRequest.startTimeUTCInMs,\n      durationInMs: gatewayRequest.durationInMs,\n      requestData,\n    });\n    this.diagnosticCtx.recordNetworkCall(gatewayRequest);\n  }\n\n  /**\n   * @internal\n   */\n  public recordFailedNetworkCall(\n    startTimeUTCInMs: number,\n    requestContext: RequestContext,\n    retryAttemptNumber: number,\n    statusCode: number,\n    substatusCode: number,\n    responseHeaders: CosmosHeaders,\n  ): void {\n    this.addData({ failedAttempty: true });\n    const requestPayloadLengthInBytes = calculateRequestPayloadLength(requestContext);\n    this.diagnosticCtx.recordFailedAttempt(\n      {\n        activityId: responseHeaders[Constants.HttpHeaders.ActivityId] as string,\n        startTimeUTCInMs,\n        durationInMs: getCurrentTimestampInMs() - startTimeUTCInMs,\n        statusCode,\n        subStatusCode: substatusCode,\n        requestPayloadLengthInBytes,\n        responsePayloadLengthInBytes: 0,\n        operationType: requestContext.operationType,\n        resourceType: requestContext.resourceType,\n      },\n      retryAttemptNumber,\n    );\n    let requestData: any = {\n      OperationType: requestContext.operationType,\n      resourceType: requestContext.resourceType,\n      requestPayloadLengthInBytes,\n    };\n    if (allowTracing(CosmosDbDiagnosticLevel.debugUnsafe, this.diagnosticLevel)) {\n      requestData = {\n        ...requestData,\n        headers: this.sanitizeHeaders(requestContext.headers),\n        requestBody: requestContext.body,\n        url: prepareURL(requestContext.endpoint, requestContext.path),\n      };\n    }\n    this.addData({\n      failedAttempty: true,\n      requestData,\n    });\n  }\n\n  /**\n   * @internal\n   */\n  public recordEndpointResolution(location: string): void {\n    this.addData({ selectedLocation: location });\n    this.diagnosticCtx.recordEndpointResolution(location);\n  }\n\n  /**\n   * @internal\n   */\n  public addData(\n    data: Partial<DiagnosticDataValue>,\n    msg?: string,\n    level: CosmosDbDiagnosticLevel = this.diagnosticLevel,\n  ): void {\n    if (level !== CosmosDbDiagnosticLevel.info) {\n      this.data = { ...this.data, ...data };\n      if (msg) {\n        this.addLog(msg);\n      }\n    }\n  }\n\n  /**\n   * Merge given DiagnosticNodeInternal's context to current node's DiagnosticContext, Treating GatewayRequests of\n   * given DiagnosticContext, as metadata requests. Given DiagnosticNodeInternal becomes a child of this node.\n   * @internal\n   */\n  public addChildNode(\n    child: DiagnosticNodeInternal,\n    level: CosmosDbDiagnosticLevel,\n    metadataType?: MetadataLookUpType,\n  ): DiagnosticNodeInternal {\n    this.diagnosticCtx.mergeDiagnostics(child.diagnosticCtx, metadataType);\n    if (allowTracing(level, this.diagnosticLevel)) {\n      child.parent = this;\n      this.children.push(child);\n    }\n    return child;\n  }\n\n  /**\n   * @internal\n   */\n  public initializeChildNode(\n    type: DiagnosticNodeType,\n    level: CosmosDbDiagnosticLevel,\n    data: Partial<DiagnosticDataValue> = {},\n  ): DiagnosticNodeInternal {\n    if (allowTracing(level, this.diagnosticLevel)) {\n      const child = new DiagnosticNodeInternal(\n        this.diagnosticLevel,\n        type,\n        this,\n        data,\n        getCurrentTimestampInMs(),\n        this.diagnosticCtx,\n      );\n      this.children.push(child);\n      return child;\n    } else {\n      return this;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  public recordQueryResult(resources: unknown, level: CosmosDbDiagnosticLevel): void {\n    if (allowTracing(level, this.diagnosticLevel)) {\n      const previousCount = this.data.queryRecordsRead ?? 0;\n      if (Array.isArray(resources)) {\n        this.data.queryRecordsRead = previousCount + resources.length;\n      }\n    }\n  }\n\n  /**\n   * Convert DiagnosticNodeInternal (internal representation) to DiagnosticNode (public, sanitized representation)\n   * @internal\n   */\n  public toDiagnosticNode(): DiagnosticNode {\n    return {\n      id: this.id,\n      nodeType: this.nodeType,\n      children: this.children.map((child) => child.toDiagnosticNode()),\n      data: this.data,\n      startTimeUTCInMs: this.startTimeUTCInMs,\n      durationInMs: this.durationInMs,\n    };\n  }\n\n  /**\n   * Convert to CosmosDiagnostics\n   * @internal\n   */\n  public toDiagnostic(clientConfigDiagnostic: ClientConfigDiagnostic): CosmosDiagnostics {\n    const rootNode = getRootNode(this);\n    const diagnostiNode = allowTracing(CosmosDbDiagnosticLevel.debug, this.diagnosticLevel)\n      ? rootNode.toDiagnosticNode()\n      : undefined;\n    const clientConfig = allowTracing(CosmosDbDiagnosticLevel.debug, this.diagnosticLevel)\n      ? clientConfigDiagnostic\n      : undefined;\n    const cosmosDiagnostic = new CosmosDiagnostics(\n      this.diagnosticCtx.getClientSideStats(),\n      diagnostiNode,\n      clientConfig,\n    );\n    return cosmosDiagnostic;\n  }\n}\n\n/**\n * @hidden\n */\nexport type DiagnosticDataValue = {\n  selectedLocation: string;\n  activityId: string;\n  requestAttempNumber: number;\n  requestPayloadLengthInBytes: number;\n  responsePayloadLengthInBytes: number;\n  responseStatus: number;\n  readFromCache: boolean;\n  operationType: OperationType;\n  metadatOperationType: MetadataLookUpType;\n  resourceType: ResourceType;\n  failedAttempty: boolean;\n  successfulRetryPolicy: string;\n  partitionKeyRangeId: string;\n  stateful: boolean;\n  queryRecordsRead: number;\n  queryMethodIdentifier: string;\n  log: string[];\n  failure: boolean;\n  startTimeUTCInMs: number;\n  durationInMs: number;\n  requestData: Partial<{\n    requestPayloadLengthInBytes: number;\n    responsePayloadLengthInBytes: number;\n    operationType: OperationType;\n    resourceType: ResourceType;\n    headers: CosmosHeaders;\n    requestBody: any;\n    responseBody: any;\n    url: string;\n  }>;\n};\n\n/**\n * @hidden\n */\nexport enum DiagnosticNodeType {\n  CLIENT_REQUEST_NODE = \"CLIENT_REQUEST_NODE\", // Top most node representing client operations.\n  METADATA_REQUEST_NODE = \"METADATA_REQUEST_NODE\", // Node representing a metadata request.\n  HTTP_REQUEST = \"HTTP_REQUEST\", // Node representing REST call to backend services.\n  BATCH_REQUEST = \"BATCH_REQUEST\", // Node representing batch request.\n  PARALLEL_QUERY_NODE = \"PARALLEL_QUERY_NODE\", // Node representing parallel query execution.\n  DEFAULT_QUERY_NODE = \"DEFAULT_QUERY_NODE\", // Node representing default query execution.\n  QUERY_REPAIR_NODE = \"QUERY_REPAIR_NODE\", // Node representing query repair.\n  BACKGROUND_REFRESH_THREAD = \"BACKGROUND_REFRESH_THREAD\", // Node representing background refresh.\n  REQUEST_ATTEMPTS = \"REQUEST_ATTEMPTS\", // Node representing request attempts.\n}\n\nfunction calculateResponsePayloadLength(response: PipelineResponse) {\n  return response?.bodyAsText?.length || 0;\n}\n\nfunction calculateRequestPayloadLength(requestContext: RequestContext) {\n  return requestContext.body ? requestContext.body.length : 0;\n}\n"]}